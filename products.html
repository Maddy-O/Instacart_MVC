<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles/products.css">
    <link rel="stylesheet" href="./styles/navbar_products.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Document</title>
</head>
<body>
    <div class="header_container">
        
    </div>
    <div class="products">
        <div class="heading">
            <span id="cat_span"></span>
        </div>
        <div class="product_categories">

        </div>
        <div class="product_lists">

        </div>
    </div>
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="display_content">
            </div>    
            <h3>Recommendations</h3>
            <div class="recommended">
                
            </div>
        </div>
    </div>
    <select id="qty" name="Qty">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
    </select>

    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn">&times;</a>
        <div>
            <span id="username">Username</span>
            <p>Instacart customer since January 2022</p>
        </div>
        <hr>
        <div class="menu">
            <div>
                <i class="fa fa-home" style="font-size:25px"></i>
                <span>Stores</span>
            </div>
            <div>
                <i class="fa fa-address-card" style="font-size:25px"></i>
                <span>Your Orders</span>
            </div>
            <div>
                <i class="fa fa-address-book" style="font-size:25px"></i>
                <span>Your Recipes</span>
            </div>
            <div>
                <i class="fa fa-gear" style="font-size:25px"></i>
                <span>Your Account Settings</span>
            </div>
            <div>
                <i class="fa fa-bolt" style="font-size:25px;color: yellow;"></i>
                <span>Try Instacart Express</span>
            </div>
            
        </div>

      </div>
      
      <!-- <h2>Animated Sidenav Example</h2>
      <p>Click on the element below to open the side navigation menu.</p>
      <span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; open</span> -->

</body>
</html>


<script type="module">
    import {getData,appendProducts,appendData} from "./scripts/main.js";
    // import navBar from "./components/navbar_products.js";

    let dropdown = document.querySelector("#qty");
    dropdown.style.display = "none"
    

    import navBar from "./components/navbar_products.js";

    // Changing the title and the bg according to selected category.
    let display_obj = JSON.parse(localStorage.getItem("cat_obj"))||{};
    document.querySelector("#cat_span").textContent = display_obj['name'];
    document.querySelector(".heading").style.backgroundImage = `url(${display_obj['poster']})`;

    // Working and displaying subcategories.
    let subCategory_url = `http://localhost:5000/subCategory/${display_obj['id']}`
    let subcategories;

    getData(subCategory_url).then((res)=>{
        subcategories = res;
    })

    setTimeout(() => {
        console.log("subs",subcategories)
        displaySubs(subcategories)
    }, 500);

    function displaySubs(subcategories){
        let main_div = document.querySelector(".product_categories");
        subcategories.forEach(element => {
            let span = document.createElement("span");
            span.textContent = element['name'];
            main_div.append(span)
        });
    }
    // Appending the navbar into html.
    let container = document.querySelector(".header_container");
    container.innerHTML = navBar()

    // Displaying the number of items.
    let cart_items = JSON.parse(localStorage.getItem("cart_items"))||[];
    let qty_span = document.querySelector("#quantity");
    qty_span.textContent = cart_items.length;

    // debouncing functionality.
    let debounce = document.querySelector(".debouncing");
    debounce.style.display = "none"

    document.querySelector("#searchBar").addEventListener("keypress",(event)=>{
        debounce.style.display = "block";
        let search_term = document.querySelector("#searchBar").value;
        let url = `https://www.themealdb.com/api/json/v1/1/search.php?s=${search_term}`
        getData(url).then((res)=>{
            if(res.meals == null || search_term == null)
            {
                debounce.style.display = "none"
                return
            }
            appendData(res.meals,debounce)
        })
    });
    
    // Making the api call.
    // let cat_name = display_obj['name'];
    // let api_url = `http://127.0.0.1:5000/api/products`;

    // if(cat_name == "Grocery" || cat_name == "Alcohol" || cat_name == "Pets"){
    //     api_url = `http://127.0.0.1:5000/api/${display_obj['name']}`;
    // }
    
    // let shops_url = "http://127.0.0.1:5000/api/shops";

    // let products_div = document.querySelector(".product_lists")
    // getData(api_url).then((res)=>{
    //     appendProducts(res,products_div,dropdown)
    // })

    // Drodown functionality.
    dropdown.addEventListener("change",()=>{
        localStorage.setItem("qty",JSON.stringify(dropdown.value))
    })


    // Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

// Routing to the checkout page.
document.querySelector("#cart").addEventListener("click",()=>{
    if(cart_items.length == 0){
        return
    }
    window.location.href = "./checkout/checkout.html"
})


document.querySelector("#menu").addEventListener("click",()=>{
    document.getElementById("mySidenav").style.width = "300px";
})

document.querySelector(".closebtn").addEventListener("click",()=>{
    document.getElementById("mySidenav").style.width = "0px";
})

</script>